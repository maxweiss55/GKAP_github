---
title: "GKAP Analysis"
author: "Max Weiss"
date: "6/1/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, output = FALSE, message = FALSE, warning = FALSE)

#Library Downloads

library(tidyverse)
library(ggplot2)
library(ggmap)
library(maps)
library(mapdata)
library(stringr)
library(lubridate)
library(knitr)
library(tidytext)
library(plotly)
library(SnowballC)
library(wordcloud)
library(RColorBrewer)
library(tm)
library(readxl)

```

```{r data load and cleaning 2011}

gkap11 <- read_csv("GKAP2011_Agg.csv")

clean11 <- gkap11 %>%
  mutate(Response_Legal = Q48B, Response_Medical = Q44A) %>% #Standardize back to original values
  mutate(Coded_Legal = case_when(is.na(Coded_Legal) ~"NA",
                                 Coded_Legal == "ind. no" ~ "indeterminate unwilling",
                                 Coded_Legal == "ind. yes" ~ "indeterminate willing",
                                 Coded_Legal == "NMI" ~ "need more information",
                                 Coded_Legal == "xx" ~ "XX",
                                 Coded_Legal == "value-n: anti-government" ~ "anti-government",
                                 Coded_Legal == "value-n: DNA skepticism" ~ "DNA skepticism",
                                 Coded_Legal == "value-n: general" ~ "general",
                                 Coded_Legal == "value-n: privacy" ~ "privacy",
                                 Coded_Legal == "value-n: violates rights" ~ "violates rights",
                                 Coded_Legal == "value-y: exoneration/innocence" ~ "exoneration/innocence",
                                 Coded_Legal == "value-y: general" ~ "general",
                                 Coded_Legal == "value-y: help society" ~ "help society",
                                 Coded_Legal == "value-y: justice" ~ "justice",
                                 Coded_Legal == "value-y: obey authority" ~ "obey authority",
                                 Coded_Legal == "value-y: punishment" ~ "punishment",
                                 Coded_Legal == "value-y: research" ~ "research",
                                 Coded_Legal == "value-y: truth" ~ "truth",
                                 TRUE ~ Coded_Legal)) %>%
  mutate(Coded_Medical_A = case_when(is.na(Coded_Medical_A) ~ "NA",
                                     Coded_Medical_A == "NMI" ~ "need more information",
                                     Coded_Medical_A == "CONDITIONAL TRUST" ~ "need more information",
                                     Coded_Medical_A == "INTEREST-NO" ~ "interest",
                                     Coded_Medical_A == "INTEREST-YES" ~ "interest",
                                     Coded_Medical_A == "MEDICAL CIRE" ~ "medical cure",
                                     Coded_Medical_A == "MEDICAL CURE" ~ "medical cure",
                                     Coded_Medical_A == "MEDICAL CURES-YES" ~ "medical cure",
                                     Coded_Medical_A == "MEDICAL CURES-YES" ~ "medical cure",
                                     Coded_Medical_A == "MEDICAL KNOWLEDGE-YES" ~ "medical cure",
                                     Coded_Medical_A == "MEDICAL RESEARCH" ~ "medical cure",
                                     Coded_Medical_A == "MEDICICAL CURE" ~ "medical cure",
                                     Coded_Medical_A == "MEDICSL CURE" ~ "medical cure",
                                     Coded_Medical_A == "MEDICSL CURE" ~ "medical cure",
                                     Coded_Medical_A == "MEDUCAL CURE" ~ "medical cure",
                                     Coded_Medical_A == "SCIENTIFIC CURE" ~ "medical cure",
                                     Coded_Medical_A == "MISTRUST" ~ "mistrust",
                                     Coded_Medical_A == "NMI-NO" ~ "need more information",
                                     Coded_Medical_A == "NMI-YES" ~ "need more information",
                                     Coded_Medical_A == "PRIVACY-NO" ~ "privacy",
                                     Coded_Medical_A == "PRIVACY-YES" ~ "privacy",
                                     Coded_Medical_A == "SAMPLING-NO" ~ "sampling",
                                     Coded_Medical_A == "SAMPLING-YES" ~ "sampling",
                                     Coded_Medical_A == "PRIVACY-NO" ~ "privacy",
                                     Coded_Medical_A == "SCIENTIFIC KNOWLEDGE" ~ "scientific knowledge",
                                     Coded_Medical_A == "SCEINTIFIC KNOWLEDGE" ~ "scientific knowledge",
                                     Coded_Medical_A == "SCIENTFIC  KNOWLEDGE" ~ "scientific knowledge",
                                     Coded_Medical_A == "SCIENTFIC KNOWLEDG" ~ "scientific knowledge",
                                     Coded_Medical_A == "SCIENTFICI KNOWLEDGE" ~ "scientific knowledge",
                                     Coded_Medical_A == "SCIENTIF KNOWLEDGE" ~ "scientific knowledge",
                                     Coded_Medical_A == "SCIENTIFC KNOWLEDGE" ~ "scientific knowledge",
                                     Coded_Medical_A == "SCIENTIFI KNOWLEDG" ~ "scientific knowledge",
                                     Coded_Medical_A == "SCIENTIFI KNOWLEDGE" ~ "scientific knowledge",
                                     Coded_Medical_A == "SCIENTIFIC KN" ~ "scientific knowledge",
                                     Coded_Medical_A == "SCIENTIFIC KNOLWEDGE" ~ "scientific knowledge",
                                     Coded_Medical_A == "SCIENTIFIC KNOWLDEGE" ~ "scientific knowledge",
                                     Coded_Medical_A == "SCIENTIFIC KNOWLEDE" ~ "scientific knowledge",
                                     Coded_Medical_A == "SCIENTIFIC KNOWLEDEGE" ~ "scientific knowledge",
                                     Coded_Medical_A == "SCIENTIFIC KNOWLEDG" ~ "scientific knowledge",
                                     Coded_Medical_A == "SCIENTIFIC KNOWLEDHE" ~ "scientific knowledge",
                                     Coded_Medical_A == "SCIENTIFIC KNOWLEGES" ~ "scientific knowledge",
                                     Coded_Medical_A == "SCIENTIFIC KNWOLEDGE" ~ "scientific knowledge",
                                     Coded_Medical_A == "SCIENTIFIC NOWLEDGE" ~ "scientific knowledge",
                                     Coded_Medical_A == "SCIENTITIC KNOWLEDGE" ~ "scientific knowledge",
                                     Coded_Medical_A == "SCINTIFIC KNOWLEDGE" ~ "scientific knowledge",
                                     Coded_Medical_A == "TRUST" ~ "trust",
                                     Coded_Medical_A == "TRUST/MISTRUST" & Response_Medical %in% c(1,2) ~ "trust",
                                     Coded_Medical_A == "TRUST/MISTRUST" & Response_Medical %in% c(3,4,5) ~ "mistrust",
                                     Coded_Medical_A == "VALUE" ~ "value",
                                     Coded_Medical_A == "VALUE-YES" ~ "value",
                                     Coded_Medical_A == "VALUE-NO" ~ "value",
                                     Coded_Medical_A == 5 ~ "XX",
                                     Coded_Medical_A == 16 ~ "XX",
                                     Coded_Medical_A == 14 ~ "XX",
                                     TRUE ~ Coded_Medical_A)) %>%
  mutate(Coded_Medical_B = case_when(Coded_Medical_B == "NMI" ~ "need more information",
                                     Coded_Medical_B == "CONDITIONAL TRUST" ~ "need more information",
                                     Coded_Medical_B == "INTEREST-NO" ~ "interest",
                                     Coded_Medical_B == "INTEREST-YES" ~ "interest",
                                     Coded_Medical_B == "MEDICAL CURE" ~ "medical cure",
                                     Coded_Medical_B == "MISTRUST" ~ "mistrust",
                                     Coded_Medical_B == "NMI-NO" ~ "need more information",
                                     Coded_Medical_B == "NMI-YES" ~ "need more information",
                                     Coded_Medical_B == "PRIVACY-NO" ~ "privacy",
                                     Coded_Medical_B == "PRIVACY-YES" ~ "privacy",
                                     Coded_Medical_B == "SAMPLING-YES" ~ "sampling",
                                     Coded_Medical_B == "SCIENTIFIC KNOWLEDGE" ~ "scientific knowledge",
                                     Coded_Medical_B == "SCIENTIFIC KNWLEDGE" ~ "scientific knowledge",
                                     Coded_Medical_B == "TRUST" ~ "trust",
                                     Coded_Medical_B == "TRUST/MISTRUST" & Response_Medical %in% c(1,2) ~ "trust",
                                     Coded_Medical_B == "TRUST/MISTRUST" & Response_Medical %in% c(3,4,5) ~ "mistrust",
                                     Coded_Medical_B == "VALUE-YES" ~ "value",
                                     Coded_Medical_B == "VALUE-NO" ~ "value",
                                     Coded_Medical_B == "5" ~ "XX",
                                     Coded_Medical_B == 5 ~ "XX",
                                     Coded_Medical_B == 16 ~ "XX",
                                     Coded_Medical_B == 14 ~ "XX",
                                     TRUE ~ Coded_Medical_B))
  
gather11 <- clean11 %>%
  gather(Coded_Medical_A, Coded_Medical_B, key = "Coded_Medical_AB", value = "Coded_Medical") %>%
  filter(!is.na(Coded_Medical)) %>%
  select(X1, CaseID, Response_Legal, OpenEnd_Legal, Coded_Legal, Response_Medical, OpenEnd_Medical, Coded_Medical_AB, Coded_Medical, weight1:pppa0012) %>%
  arrange(CaseID)

clean11 %>% write_csv("GKAP2011_Clean.csv")
gather11 %>% write_csv("GKAP2011_Split.csv")

```


```{r data load and cleaning 2017}

gkap17 <- read_csv("GKAP2017_Agg.csv")

clean17 <- gkap17 %>%
  mutate(Coded_Legal = case_when(is.na(Coded_Legal) ~"NA",
                                 Coded_Legal == "Na" ~"NA",
                                 Coded_Legal == "na" ~"NA",
                                 Coded_Legal == "ind. no" ~ "indeterminate unwilling",
                                 Coded_Legal == "ind. yes" ~ "indeterminate willing",
                                 Coded_Legal == "NMI" ~ "need more information",
                                 Coded_Legal == "xx" ~ "XX",
                                 Coded_Legal == "value-n: anti-government" ~ "anti-government",
                                 Coded_Legal == "value-n: DNA skepticism" ~ "DNA skepticism",
                                 Coded_Legal == "value-n: general" ~ "general",
                                 Coded_Legal == "value-n: privacy" ~ "privacy",
                                 Coded_Legal == "value-n: violates rights" ~ "violates rights",
                                 Coded_Legal == "value-y: exoneration/innocence" ~ "exoneration/innocence",
                                 Coded_Legal == "value-y: general" ~ "general",
                                 Coded_Legal == "value-y: help society" ~ "help society",
                                 Coded_Legal == "value-y: justice" ~ "justice",
                                 Coded_Legal == "value-y: obey authority" ~ "obey authority",
                                 Coded_Legal == "value-y: punishment" ~ "punishment",
                                 Coded_Legal == "value-y: research" ~ "research",
                                 Coded_Legal == "value-y: truth" ~ "truth",
                                 TRUE ~ Coded_Legal)) %>%
  mutate(Coded_Medical_A = case_when(is.na(Coded_Medical_A) ~ "NA",
                                 Coded_Medical_A == "conditional trust" ~ "need more information",
                                 Coded_Medical_A == "conditional mistrust" ~ "need more information",
                                 TRUE ~ Coded_Medical_A)) %>%
  mutate(Coded_Medical_B = case_when(Coded_Medical_B == "conditional trust" ~ "need more information",
                                 Coded_Medical_B == "conditional mistrust" ~ "need more information",
                                 TRUE ~ Coded_Medical_B))

gather17 <- clean17 %>%
  gather(Coded_Medical_A, Coded_Medical_B, key = "Coded_Medical_AB", value = "Coded_Medical") %>%
  filter(!is.na(Coded_Medical)) %>%
  select(X1, CaseID, Response_Legal, OpenEnd_Legal, Coded_Legal, Response_Medical, OpenEnd_Medical, Coded_Medical_AB, Coded_Medical, weight1:pppa1690) %>%
  arrange(CaseID)

clean17 %>% write_csv("GKAP2017_Clean.csv")
gather17 %>% write_csv("GKAP2017_Split.csv")

```

```{r Summary}

#How Many Respondents?

respondents17 <- clean17 %>%
  summarize("Respondents" = n())

respondents11 <- clean11 %>%
  summarize("Respondents" = n())

```

##Summary

* Number of Respondents
    + 2011: `r respondents11`
    + 2017: `r respondents17`


```{r Summary Favorability}

#LEGAL QUESTION 2017:
#Would you be willing or unwilling to contribute a DNA sample, for example by a swab from
#your mouth, for use in current or future investigations to determine a person’s guilt or
#innocence of a particular crime?

#MEDICAL QUESTION 2017:
#Would you be willing or unwilling to contribute a DNA sample, for example by a swab from
#your mouth, for use in current or future scientific or medical research?

cat11 <- clean11 %>%
  mutate(Response_Legal = case_when(Response_Legal == 1 ~ "Willing",
                                    Response_Legal == 2 ~ "Somewhat willing",
                                    Response_Legal == 3 ~ "Somewhat unwilling",
                                    Response_Legal == 4 ~ "Unwilling",
                                    Response_Legal == -1 ~ "REFUSED")) %>%
  mutate(Response_Medical = case_when(Response_Medical == 1 ~ "Willing",
                                    Response_Medical == 2 ~ "Somewhat willing",
                                    Response_Medical == 3 ~ "Somewhat unwilling",
                                    Response_Medical == 4 ~ "Unwilling",
                                    Response_Medical == -1 ~ "REFUSED"))

#LEGAL QUESTION 2017:
#Would you be willing or unwilling to contribute a DNA sample, for example by a swab from
#your mouth, for use in current or future investigations to determine a person’s guilt or
#innocence of a particular crime?

#MEDICAL QUESTION 2017:
#Would you be willing or unwilling to contribute a DNA sample, for example by a swab from
#your mouth, for use in current or future scientific or medical research?

cat17 <- clean17 %>%
  mutate(Response_Legal = case_when(Response_Legal == 1 ~ "Willing",
                                    Response_Legal == 2 ~ "Somewhat willing",
                                    Response_Legal == 3 ~ "Somewhat unwilling",
                                    Response_Legal == 4 ~ "Unwilling",
                                    Response_Legal == -1 ~ "REFUSED")) %>%
  mutate(Response_Medical = case_when(Response_Medical == 1 ~ "Willing",
                                    Response_Medical == 2 ~ "Somewhat willing",
                                    Response_Medical == 3 ~ "Somewhat unwilling",
                                    Response_Medical == 4 ~ "Unwilling",
                                    Response_Medical == -1 ~ "REFUSED"))

cat11 %>%
  gather(Response_Legal, Response_Medical, key = "Type", value = "Favorability") %>%
  group_by(Type) %>%
  count(Favorability) %>%
  mutate(Favorability = fct_relevel(Favorability, "Willing", "Somewhat willing", "Somewhat unwilling", "Unwilling", "REFUSED")) %>%
  ggplot(aes(x = Favorability, y = n, fill = Type)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

cat17 %>%
  gather(Response_Legal, Response_Medical, key = "Type", value = "Favorability") %>%
  group_by(Type) %>%
  count(Favorability) %>%
  mutate(Favorability = fct_relevel(Favorability, "Willing", "Somewhat willing", "Somewhat unwilling", "Unwilling", "REFUSED")) %>%
  ggplot(aes(x = Favorability, y = n, fill = Type)) +
  geom_col(position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))

#Average Favorabilities

calc11 <- clean11 %>%
  mutate(Response_Legal = case_when(Response_Legal == 1 ~ '3',
                                    Response_Legal == 2 ~ '2',
                                    Response_Legal == 3 ~ '1',
                                    Response_Legal == 4 ~ '0',
                                    Response_Legal == -1 ~ NA_character_)) %>%
  mutate(Response_Legal = parse_integer(Response_Legal)) %>%
  mutate(Response_Medical = case_when(Response_Medical == 1 ~ '3',
                                    Response_Medical == 2 ~ '2',
                                    Response_Medical == 3 ~ '1',
                                    Response_Medical == 4 ~ '0',
                                    Response_Medical == -1 ~ NA_character_)) %>%
  mutate(Response_Medical = parse_integer(Response_Medical))
  

calc17 <- clean17 %>%
  mutate(Response_Legal = case_when(Response_Legal == 1 ~ '3',
                                    Response_Legal == 2 ~ '2',
                                    Response_Legal == 3 ~ '1',
                                    Response_Legal == 4 ~ '0',
                                    Response_Legal == -1 ~ NA_character_)) %>%
  mutate(Response_Legal = parse_integer(Response_Legal)) %>%
  mutate(Response_Medical = case_when(Response_Medical == 1 ~ '3',
                                    Response_Medical == 2 ~ '2',
                                    Response_Medical == 3 ~ '1',
                                    Response_Medical == 4 ~ '0',
                                    Response_Medical == -1 ~ NA_character_)) %>%
  mutate(Response_Medical = parse_integer(Response_Medical))

calc11 %>%
  summarise(Legal_Favorability = mean(Response_Legal, na.rm = TRUE), 
            Medical_Favorability = mean(Response_Medical, na.rm = TRUE), 
            sd_leg = sd(Response_Legal, na.rm = TRUE),
            se_leg = 1.96 * sd_leg/sqrt(n()),
            sd_med = sd(Response_Medical, na.rm = TRUE),
            se_med = 1.96 * sd_med/sqrt(n())) %>%
  gather(Legal_Favorability, Medical_Favorability, key = "Type", value = "Favorability") %>%
  mutate(se = ifelse(Type == "Legal_Favorability", se_leg, se_med)) %>%
  select(Type, Favorability, se) %>%
  ggplot(aes(x = Type, y = Favorability)) +
  geom_col(position = "dodge", fill = "royalblue4") +
  geom_errorbar(aes(ymin = Favorability - se, ymax = Favorability + se), width=.4) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(title = "Average Favorability Score Med vs. Legal 2011", caption = "CAPTION CAPTION CAPTION") +
  scale_y_continuous(name = "Average Favorability", limits = c(0, 3), breaks = seq(0, 3, length.out = 7))

calc17 %>%
  summarise(Legal_Favorability = mean(Response_Legal, na.rm = TRUE), 
            Medical_Favorability = mean(Response_Medical, na.rm = TRUE), 
            sd_leg = sd(Response_Legal, na.rm = TRUE),
            se_leg = 1.96 * sd_leg/sqrt(n()),
            sd_med = sd(Response_Medical, na.rm = TRUE),
            se_med = 1.96 * sd_med/sqrt(n())) %>%
  gather(Legal_Favorability, Medical_Favorability, key = "Type", value = "Favorability") %>%
  mutate(se = ifelse(Type == "Legal_Favorability", se_leg, se_med)) %>%
  select(Type, Favorability, se) %>%
  ggplot(aes(x = Type, y = Favorability)) +
  geom_col(position = "dodge", fill = "royalblue4") +
  geom_errorbar(aes(ymin = Favorability - se, ymax = Favorability + se), width=.4) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(title = "Average Favorability Score Med vs. Legal 2017", caption = "CAPTION CAPTION CAPTION") +
  scale_y_continuous(name = "Average Favorability", limits = c(0, 3), breaks = seq(0, 3, length.out = 7))



calc11_2 <- calc11 %>%
  summarise(Legal_Favorability = mean(Response_Legal, na.rm = TRUE), 
            Medical_Favorability = mean(Response_Medical, na.rm = TRUE), 
            sd_leg = sd(Response_Legal, na.rm = TRUE),
            se_leg = 1.96 * sd_leg/sqrt(n()),
            sd_med = sd(Response_Medical, na.rm = TRUE),
            se_med = 1.96 * sd_med/sqrt(n())) %>%
  gather(Legal_Favorability, Medical_Favorability, key = "Type", value = "Favorability") %>%
  mutate(se = ifelse(Type == "Legal_Favorability", se_leg, se_med), Year = '2011') %>%
  select(Type, Favorability, se, Year)

calc17 %>%
  summarise(Legal_Favorability = mean(Response_Legal, na.rm = TRUE), 
            Medical_Favorability = mean(Response_Medical, na.rm = TRUE), 
            sd_leg = sd(Response_Legal, na.rm = TRUE),
            se_leg = 1.96 * sd_leg/sqrt(n()),
            sd_med = sd(Response_Medical, na.rm = TRUE),
            se_med = 1.96 * sd_med/sqrt(n())) %>%
  gather(Legal_Favorability, Medical_Favorability, key = "Type", value = "Favorability") %>%
  mutate(se = ifelse(Type == "Legal_Favorability", se_leg, se_med), Year = '2017') %>%
  select(Type, Favorability, se, Year) %>%
  bind_rows(calc11_2) %>%
  ggplot(aes(x = Type, y = Favorability, fill = Year)) +
  geom_col(position = "dodge") +
  geom_errorbar(aes(ymin = Favorability - se, ymax = Favorability + se), width= .9, position = "dodge") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(title = "Average Favorability Score Med vs. Legal 2011/2017", caption = "CAPTION CAPTION CAPTION") +
  scale_y_continuous(name = "Average Favorability", limits = c(0, 3), breaks = seq(0, 3, length.out = 7))
  

```

```{r Open End Analysis}

#Legal Open End Classifications

leg11 <- clean11 %>%
  select(X1:Coded_Medical_B) %>%
  mutate(Year = '2011')
  

leg17 <- clean17 %>% 
  select(X1:Coded_Medical_B) %>%
  mutate(Year = '2017')

leg11 %>%
  bind_rows(leg17) %>%
  group_by(Year) %>%
  count(Coded_Legal) %>%
  mutate(`Relative Frequency` = n/sum(n)) %>%
  ggplot(aes(x = Coded_Legal, y = `Relative Frequency`, fill = Year)) +
  geom_col(position = 'dodge') +
  ylab("Relative Frequencies") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(title = "Frequency of Open-Ended Response Classifications (ADJUSTED)")


#Medical Open End Classifications

label11 <- gather11 %>%
  select(X1:Coded_Medical) %>%
  mutate(Year = '2011')
  

label17 <- gather17 %>% 
  select(X1:Coded_Medical) %>%
  mutate(Year = '2017')

label11 %>%
  bind_rows(label17) %>%
  group_by(Year) %>%
  count(Coded_Medical) %>%
  mutate(`Relative Frequency` = n/sum(n)) %>%
  ggplot(aes(x = Coded_Medical, y = `Relative Frequency`, fill = Year)) +
  geom_col(position = 'dodge') +
  ylab("Relative Frequencies") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(title = "Frequency of Open-Ended Response Classifications (ADJUSTED)")





calc11 %>%
  group_by(Coded_Legal) %>%
  summarise(Legal_Favorability = mean(Response_Legal, na.rm = TRUE)) %>%
  mutate(sd = sd(Legal_Favorability), se = 1.96 * sd/sqrt(n())) %>%
  ggplot(aes(x = Coded_Legal, y = Legal_Favorability)) +
  geom_col() +
  geom_errorbar(aes(ymin = Legal_Favorability - se, ymax = Legal_Favorability + se), width=.2, position=position_dodge(.9)) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(title = "Average Favorability Score Med vs. Legal 2011", caption = "CAPTION CAPTION CAPTION") +
  scale_y_continuous(name = "Average Favorability", limits = c(0, 3))

```





